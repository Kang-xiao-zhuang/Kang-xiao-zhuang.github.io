<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Java网络编程学习笔记 | 康小庄的博客</title><meta name="keywords" content="网络编程"><meta name="author" content="康小庄"><meta name="copyright" content="康小庄"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Java网络编程学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="Java网络编程学习笔记">
<meta property="og:url" content="http://example.com/2021/01/11/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="康小庄的博客">
<meta property="og:description" content="Java网络编程学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic.imgdb.cn/item/60cd5fb8844ef46bb26ac268.jpg">
<meta property="article:published_time" content="2021-01-11T08:38:03.000Z">
<meta property="article:modified_time" content="2021-06-19T03:10:00.000Z">
<meta property="article:author" content="康小庄">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/60cd5fb8844ef46bb26ac268.jpg"><link rel="shortcut icon" href="/img/2.png"><link rel="canonical" href="http://example.com/2021/01/11/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":180,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java网络编程学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-19 11:10:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/customer_zk.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">57</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw far fa-image"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline"><i class="fa-fw fas fa-link"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/60cd5fb8844ef46bb26ac268.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">康小庄的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw far fa-image"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/timeline"><i class="fa-fw fas fa-link"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java网络编程学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-11T08:38:03.000Z" title="发表于 2021-01-11 16:38:03">2021-01-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-19T03:10:00.000Z" title="更新于 2021-06-19 11:10:00">2021-06-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>51分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java网络编程学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Java网络编程学习笔记"><a href="#Java网络编程学习笔记" class="headerlink" title="Java网络编程学习笔记"></a>Java网络编程学习笔记</h1><p>写在前面：感谢韩老师的讲解视频！</p>
<p><strong>学习地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j54y1b7qv">【韩顺平讲Java】Java网络多线程专题 - TCP UDP Socket编程</a></strong></p>
<h1 id="1-网络的相关概念"><a href="#1-网络的相关概念" class="headerlink" title="1. 网络的相关概念"></a>1. 网络的相关概念</h1><h2 id="1-1-网络通信"><a href="#1-1-网络通信" class="headerlink" title="1.1 网络通信"></a>1.1 网络通信</h2><ul>
<li>概念：两台设备之间通过网络实现数据传输</li>
<li>网络通信：将数据通过网络从一台设备传输到另以台设备</li>
<li>java.net包下提供了一系列的类或接口，供程序员使用，完成网络通信</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wsEj"><img src="https://z3.ax1x.com/2021/06/03/21wsEj.png" alt="21wsEj.png"></a></p>
<h2 id="1-2-网络"><a href="#1-2-网络" class="headerlink" title="1.2 网络"></a>1.2 网络</h2><ul>
<li>概念：两台或多台设备通过一定物理设备连接来构成了网络</li>
<li>根据网络的覆盖范围不同，对网络进行分类</li>
<li>局域网：覆盖范围最小，仅仅覆盖一个教室或者一个机房</li>
<li>城域网：覆盖范围比较大，可以覆盖一个城市</li>
<li>广域网：覆盖范围最大，可以覆盖全国，甚至全球，万维网是广域网的代表</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wyUs"><img src="https://z3.ax1x.com/2021/06/03/21wyUs.png" alt="21wyUs.png"></a></p>
<h2 id="1-3-IP地址"><a href="#1-3-IP地址" class="headerlink" title="1.3 IP地址"></a>1.3 IP地址</h2><ul>
<li>概念：用于唯一标识网络中的每台主机/计算机</li>
<li>查看IP地址的命令：ipconfig</li>
<li>ip地址的表示形式：点分十进制 xx.xx.xx.xx</li>
<li>每一个十进制的范围 0-255</li>
<li>ip地址的组成=网络地址+主机地址  例如192.168.152.xxx</li>
<li>ipv6是互联网工程任务组设计的用于替代IPv4的下一代IP协议</li>
<li>由于IPv4最大的问题在于网络地址资源有限，严重制约了互联网的应用和发展，IPv6的使用可以解决网络地址资源数量的问题，也解决了多种接入设备互联网的障碍</li>
</ul>
<p>更多了解IPv6参考 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IPv6/172297">IPv6_百度百科 (baidu.com)</a></p>
<h2 id="1-4-ipv4-地址分类"><a href="#1-4-ipv4-地址分类" class="headerlink" title="1.4 ipv4 地址分类"></a>1.4 ipv4 地址分类</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21w65n"><img src="https://z3.ax1x.com/2021/06/03/21w65n.png" alt="21w65n.png"></a></p>
<p><img src="http://qtwu22ub9.hn-bkt.clouddn.com/img/image-20210601211137383.png" alt="image-20210601211137383"></p>
<h2 id="1-5-域名"><a href="#1-5-域名" class="headerlink" title="1.5 域名"></a>1.5 域名</h2><ul>
<li>好处：方便记忆，解决记ip的困难</li>
<li>概念：将ip地址映射成域名，HTTP协议</li>
</ul>
<p><strong>端口号</strong></p>
<ul>
<li>概念：用于标识计算机上某个特定的网络程序</li>
<li>表示形式：以整数形式，端口范围0-65535 [2个字节表示端口 0~2的16次-1]</li>
<li>常见网络程序端口号<ul>
<li>tomcat：8080</li>
<li>mysql：3306</li>
<li>sqlserve：1433</li>
</ul>
</li>
</ul>
<h2 id="1-6-网络通信协议"><a href="#1-6-网络通信协议" class="headerlink" title="1.6 网络通信协议"></a>1.6 网络通信协议</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wDbQ"><img src="https://z3.ax1x.com/2021/06/03/21wDbQ.png" alt="21wDbQ.png"></a></p>
<ul>
<li>TCP/IP（Transmission Control Protocol/Internet Protocol，传输控制协议/网际协议）是指能够在多个不同网络间实现信息传输的协议簇</li>
</ul>
<table>
<thead>
<tr>
<th align="center">OSI模型</th>
<th align="center">TCP/IP模型</th>
<th align="center">TCP/IP模型各层对应协议</th>
</tr>
</thead>
<tbody><tr>
<td align="center">应用层</td>
<td align="center">应用层</td>
<td align="center">HTTP FTP DNS…</td>
</tr>
<tr>
<td align="center">表示层</td>
<td align="center">应用层</td>
<td align="center">HTTP FTP DNS…</td>
</tr>
<tr>
<td align="center">会话层</td>
<td align="center">应用层</td>
<td align="center">HTTP FTP DNS…</td>
</tr>
<tr>
<td align="center">传输层</td>
<td align="center">传输层(TCP)</td>
<td align="center">TCP UDP…</td>
</tr>
<tr>
<td align="center">网络层</td>
<td align="center">网络层(IP)</td>
<td align="center">IP ICMP ARP</td>
</tr>
<tr>
<td align="center">数据链路层</td>
<td align="center">物理+数据链路层</td>
<td align="center">Link</td>
</tr>
<tr>
<td align="center">物理层</td>
<td align="center">物理+数据链路层</td>
<td align="center">Link</td>
</tr>
</tbody></table>
<h2 id="1-7-TCP和UDP"><a href="#1-7-TCP和UDP" class="headerlink" title="1.7 TCP和UDP"></a>1.7 TCP和UDP</h2><p><strong>TCP协议:传输控制协议</strong></p>
<ul>
<li>1.使用TCP协议前，须先建立TCP连接，形成传输数据通道</li>
<li>2.传输前，采用”三次握手”方式，是可靠的</li>
<li>3.TCP协议进行通信的两个应用进程:客户端、服务端</li>
<li>4.在连接中可进行大数据量的传输</li>
<li>5.传输完毕，需释放已建立的连接，效率低</li>
</ul>
<p><strong>UDP协议:用户数据协议</strong></p>
<ul>
<li>1.将数据、源、目的封装成数据包，不需要建立连接</li>
<li>2.每个数据报的大小限制在64K内,不适合传输大量数据</li>
<li>3.因无需连接，故是不可靠的</li>
<li>4.发送数据结束时无需释放资源(因为不是面向连接的)，速度快</li>
<li>5.举例:厕所通知:发短信</li>
</ul>
<h1 id="2-InetAddress类"><a href="#2-InetAddress类" class="headerlink" title="2. InetAddress类"></a>2. InetAddress类</h1><p>常用方法</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wBDg"><img src="https://z3.ax1x.com/2021/06/03/21wBDg.png" alt="21wBDg.png"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> API_</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 网络编程常用api</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">API_</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取本机 InetAddress 对象 getLocalHost</span></span><br><span class="line">        InetAddress localHost = InetAddress.getLocalHost();</span><br><span class="line">        System.out.println(localHost);</span><br><span class="line">        <span class="comment">//根据指定主机名/域名获取 ip 地址对象 getByName</span></span><br><span class="line">        InetAddress host2 = InetAddress.getByName(<span class="string">&quot;DESKTOP-5H1AECH&quot;</span>);</span><br><span class="line">        System.out.println(host2);</span><br><span class="line">        InetAddress host3 = InetAddress.getByName(<span class="string">&quot;itkxz.cn&quot;</span>);</span><br><span class="line">        System.out.println(host3);</span><br><span class="line">        <span class="comment">//获取 InetAddress 对象的主机名 getHostName</span></span><br><span class="line">        String host3Name = host3.getHostName();</span><br><span class="line">        System.out.println(host3Name);</span><br><span class="line">        <span class="comment">//获取 InetAddress 对象的地址 getHostAddress</span></span><br><span class="line">        String host3Address = host3.getHostAddress();</span><br><span class="line">        System.out.println(host3Address);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-Socket"><a href="#3-Socket" class="headerlink" title="3. Socket"></a>3. Socket</h1><p>基本介绍</p>
<ul>
<li>套接字(Socket)开发网络应用程序被广泛使用</li>
<li>通信的两端都要有Socket，是两台机器通信的端点</li>
<li>网络通信其实就是Socket的通信</li>
<li>Socket允许程序把网络连接当初一个流，数据在两个Socket间通过IO传输</li>
<li>一般主动发起通信的应用程序属于<code>客户端</code>，等待通信请求的为<code>服务端</code></li>
</ul>
<p><strong>示意图</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wgCq"><img src="https://z3.ax1x.com/2021/06/03/21wgCq.png" alt="21wgCq.png"></a></p>
<h1 id="4-TCP-网络通信编程"><a href="#4-TCP-网络通信编程" class="headerlink" title="4. TCP 网络通信编程"></a>4. TCP 网络通信编程</h1><p>基本介绍</p>
<ul>
<li>基于客户端—服务端的网络通信</li>
<li>底层使用的是TCP/IP协议</li>
<li>场景举例：客户端发送数据，服务端接受并显示在控制台</li>
<li>基于Socket的TCP编程</li>
</ul>
<h2 id="4-1-练习"><a href="#4-1-练习" class="headerlink" title="4.1 练习"></a>4.1 练习</h2><h3 id="4-1-1-使用字节流-练习1"><a href="#4-1-1-使用字节流-练习1" class="headerlink" title="4.1.1 使用字节流(练习1)"></a>4.1.1 使用字节流(练习1)</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wR2V"><img src="https://z3.ax1x.com/2021/06/03/21wR2V.png" alt="21wR2V.png"></a></p>
<p><strong>SocketTCP01Server</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP01Server</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP01Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        没有客户端连接9999端口会一直阻塞，等待连接</span></span><br><span class="line"><span class="comment">        如果有客户端连接，会返回Socket对象，程序继续</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在9999端口监听！&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端 socket=&quot;</span>+socket.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过socket.getInputStream()  读取客户端写入数据通信的数据，显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// IO读取</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> readLength = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((readLength=inputStream.read(buf))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//读取到的实际长度，显示内容</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(buf,<span class="number">0</span>, readLength));</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        关闭流和socket</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SocketTCP01Client</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP01Client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP01Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//思路</span></span><br><span class="line">    <span class="comment">//1. 连接服务端 (ip , 端口）</span></span><br><span class="line">    <span class="comment">//解读: 连接本机的 9999 端口, 如果连接成功，返回 Socket 对象</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端 socket 返回=&quot;</span> + socket.getClass());</span><br><span class="line">    <span class="comment">//2. 连接上后，生成 Socket, 通过 socket.getOutputStream()</span></span><br><span class="line">    <span class="comment">// 得到 和 socket 对象关联的输出流对象</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">    <span class="comment">//3. 通过输出流，写入数据到 数据通道</span></span><br><span class="line">        outputStream.write(<span class="string">&quot;hello, server&quot;</span>.getBytes());</span><br><span class="line">    <span class="comment">//4. 关闭流对象和 socket, 必须关闭</span></span><br><span class="line">        outputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-1-2-使用字节流-练习2"><a href="#4-1-2-使用字节流-练习2" class="headerlink" title="4.1.2 使用字节流(练习2)"></a>4.1.2 使用字节流(练习2)</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21wWvT"><img src="https://z3.ax1x.com/2021/06/03/21wWvT.png" alt="21wWvT.png"></a></p>
<p><strong>SocketTCP02Server</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP02Server</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP02Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        没有客户端连接9999端口会一直阻塞，等待连接</span></span><br><span class="line"><span class="comment">        如果有客户端连接，会返回Socket对象，程序继续</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在9999端口监听！&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端 socket=&quot;</span>+socket.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过socket.getInputStream()  读取客户端写入数据通信的数据，显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// IO读取</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> readLength = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((readLength=inputStream.read(buf))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//读取到的实际长度，显示内容</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(buf,<span class="number">0</span>, readLength));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5. 获取 socket 相关联的输出流</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">        outputStream.write(<span class="string">&quot;hello, client&quot;</span>.getBytes());</span><br><span class="line">        <span class="comment">// 设置结束标记</span></span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        关闭流和socket</span></span><br><span class="line">        inputStream.close();</span><br><span class="line">        outputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SocketTCP02Client</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP02Client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP02Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//思路</span></span><br><span class="line">    <span class="comment">//1. 连接服务端 (ip , 端口）</span></span><br><span class="line">    <span class="comment">//解读: 连接本机的 9999 端口, 如果连接成功，返回 Socket 对象</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端 socket 返回=&quot;</span> + socket.getClass());</span><br><span class="line">    <span class="comment">//2. 连接上后，生成 Socket, 通过 socket.getOutputStream()</span></span><br><span class="line">    <span class="comment">// 得到 和 socket 对象关联的输出流对象</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">    <span class="comment">//3. 通过输出流，写入数据到 数据通道</span></span><br><span class="line">        outputStream.write(<span class="string">&quot;hello, server&quot;</span>.getBytes());</span><br><span class="line">        <span class="comment">// 设置结束标记</span></span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line">    <span class="comment">//4. 获取和 socket 关联的输入流. 读取数据(字节)，并显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> readLen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((readLen = inputStream.read(buf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(buf, <span class="number">0</span>, readLen));</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//5. 关闭流对象和 socket, 必须关闭</span></span><br><span class="line">        outputStream.close();</span><br><span class="line">        inputStream.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-1-3-使用字符流-练习3"><a href="#4-1-3-使用字符流-练习3" class="headerlink" title="4.1.3 使用字符流(练习3)"></a>4.1.3 使用字符流(练习3)</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/21whKU"><img src="https://z3.ax1x.com/2021/06/03/21whKU.png" alt="21whKU.png"></a></p>
<p><strong>SocketTCP03Server</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP03Server</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP03Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        没有客户端连接9999端口会一直阻塞，等待连接</span></span><br><span class="line"><span class="comment">        如果有客户端连接，会返回Socket对象，程序继续</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在9999端口监听！&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端 socket=&quot;</span>+socket.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 连接上后，生成 Socket, 通过 socket.getOutputStream()</span></span><br><span class="line">        <span class="comment">//3. 通过 socket.getInputStream() 读取客户端写入到数据通道的数据, 显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="comment">//4. IO 读取, 使用字符流, 老师使用 InputStreamReader 将 inputStream 转成字符流</span></span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String s = bufferedReader.readLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取 socket 相关联的输出流</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用字符输出流的方式回复信息</span></span><br><span class="line">        BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outputStream));</span><br><span class="line">        bufferedWriter.write(<span class="string">&quot;hello client 字符流&quot;</span>);</span><br><span class="line">        bufferedWriter.newLine();<span class="comment">// 插入一个换行符，表示回复内容的结束</span></span><br><span class="line">        bufferedWriter.flush();<span class="comment">//注意需要手动的 flush</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();<span class="comment">//关闭</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>SocketTCP03Client</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SocketTCP03Client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 12:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketTCP03Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端 socket 返回=&quot;</span> + socket.getClass());</span><br><span class="line">        <span class="comment">//2. 连接上后，生成 Socket, 通过 socket.getOutputStream()</span></span><br><span class="line">        <span class="comment">// 得到 和 socket 对象关联的输出流对象</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//3. 通过输出流，写入数据到 数据通道, 使用字符流</span></span><br><span class="line">        BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outputStream));</span><br><span class="line">        bufferedWriter.write(<span class="string">&quot;hello, server 字符流&quot;</span>);</span><br><span class="line">        bufferedWriter.newLine();<span class="comment">//插入一个换行符，表示写入的内容结束, 注意，要求对方使用 readLine()!!!!</span></span><br><span class="line">        bufferedWriter.flush();<span class="comment">// 如果使用的字符流，需要手动刷新，否则数据不会写入数据通道</span></span><br><span class="line">        <span class="comment">//4. 获取和 socket 关联的输入流. 读取数据(字符)，并显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String s = bufferedReader.readLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        <span class="comment">//5. 关闭流对象和 socket, 必须关闭</span></span><br><span class="line">        bufferedReader.close();<span class="comment">//关闭外层流</span></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-1-4-发送图片-练习4"><a href="#4-1-4-发送图片-练习4" class="headerlink" title="4.1.4 发送图片(练习4)"></a>4.1.4 发送图片(练习4)</h3><blockquote>
<ul>
<li>编写一个服务端，和一个客户端</li>
<li>在8888端口监听</li>
<li>连接到服务端 发送一张图片</li>
<li>服务端接收到 客户端发送的图片 保存到指定目录下，发送“收到图片”后退出</li>
<li>客户端接受到服务端发送“收到图片” 再退出</li>
</ul>
</blockquote>
<p><strong>使用到一个工具类 StreamUtils</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> StreamUtils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 用一句话描述类的作用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/3 13:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 此类用于演示关于流的读写方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：将输入流转换成byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> is</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] streamToByteArray(InputStream is) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();<span class="comment">//创建输出流对象</span></span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">while</span>((len=is.read(b))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            bos.write(b, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">byte</span>[] array = bos.toByteArray();</span><br><span class="line">        bos.close();</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：将InputStream转换成String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> is</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">streamToString</span><span class="params">(InputStream is)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">        StringBuilder builder= <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span>((line=reader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            builder.append(line+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>TCPFileUploadServer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> TCPFileUploadServer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 文件上传服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 9:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPFileUploadServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 在本机监听8888端口</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端在8888端口监听......&quot;</span>);</span><br><span class="line">        <span class="comment">//等待连接</span></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line">        <span class="comment">//读取客户端的数据 通过Socket得到输入流</span></span><br><span class="line">        BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(socket.getInputStream());</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);</span><br><span class="line">        <span class="comment">//将得到的数组写入指定路径</span></span><br><span class="line">        String desFilePath = <span class="string">&quot;f:\\2.jpg&quot;</span>;</span><br><span class="line">        BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(desFilePath));</span><br><span class="line">        bos.write(bytes);</span><br><span class="line">        bos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向客户端回复 收到图片</span></span><br><span class="line">        <span class="comment">//通过socket 获取到输入流</span></span><br><span class="line">        BufferedWriter writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">        writer.write(<span class="string">&quot;收到图片&quot;</span>);</span><br><span class="line">        <span class="comment">// 把内容刷新到数据通道</span></span><br><span class="line">        writer.flush();</span><br><span class="line">        <span class="comment">//设置写入结束标记</span></span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line"></span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">        bos.close();</span><br><span class="line">        bis.close();</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>TCPFileUploadClient</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> TCPFileUploadClient</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 文件上传客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 9:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPFileUploadClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//客户端连接服务端8888，得到Socket对象</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(InetAddress.getLocalHost(), <span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//创建读取磁盘的文件</span></span><br><span class="line">        String filePath=<span class="string">&quot;f:\\1.jpg&quot;</span>;</span><br><span class="line">        BufferedInputStream bis = <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(filePath));</span><br><span class="line">        <span class="comment">//数组就是FilePath所对应的字节数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = StreamUtils.streamToByteArray(bis);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        通过socket获取到输入流，将bytes数据发送给服务端</span></span><br><span class="line">        BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(socket.getOutputStream());</span><br><span class="line">        bos.write(bytes);</span><br><span class="line">        bis.close();</span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        接受从服务端回复的消息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="comment">//转成字符串</span></span><br><span class="line">        String s = StreamUtils.streamToString(inputStream);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        inputStream.close();</span><br><span class="line">        bos.close();</span><br><span class="line">        socket.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="5-netstat-指令"><a href="#5-netstat-指令" class="headerlink" title="5. netstat 指令"></a>5. netstat 指令</h1><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2GKweP"><img src="https://z3.ax1x.com/2021/06/04/2GKweP.png" alt="2GKweP.png"></a></p>
<p><strong>示意图</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2GlBo6"><img src="https://z3.ax1x.com/2021/06/04/2GlBo6.png" alt="2GlBo6.png"></a></p>
<ul>
<li>当客户端连接到服务端后，实际上客户端也是通过一个端口和服务端来进行通讯的，这个端口是TVP/IP来分配的，是随机的</li>
</ul>
<h1 id="6-UDP-网络通信编程"><a href="#6-UDP-网络通信编程" class="headerlink" title="6. UDP 网络通信编程"></a>6. UDP 网络通信编程</h1><p><strong>基本介绍</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2G1CpF"><img src="https://z3.ax1x.com/2021/06/04/2G1CpF.png" alt="2G1CpF.png"></a></p>
<p><strong>基本流程</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2G1nfO"><img src="https://z3.ax1x.com/2021/06/04/2G1nfO.png" alt="2G1nfO.png"></a></p>
<p><strong>案例</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2G1lXd"><img src="https://z3.ax1x.com/2021/06/04/2G1lXd.png" alt="2G1lXd.png"></a></p>
<p><strong>UDPReceiverA</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> UDPReceiverA</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> UDP 接收端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPReceiverA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建一个 DatagramSocket 对象，准备在9999接收数据</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket(<span class="number">9999</span>);</span><br><span class="line">        <span class="comment">//2. 构建一个 DatagramPacket 对象，准备接收数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">        <span class="comment">//3. 调用 接收方法, 将通过网络传输的 DatagramPacket 对象</span></span><br><span class="line">        <span class="comment">//   填充到 packet对象</span></span><br><span class="line">        <span class="comment">//当有数据包发送到 本机的9999端口时，就会接收到数据</span></span><br><span class="line">        <span class="comment">//   如果没有数据包发送到 本机的9999端口, 就会阻塞等待.</span></span><br><span class="line">        System.out.println(<span class="string">&quot;接收端A 等待接收数据..&quot;</span>);</span><br><span class="line">        socket.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 可以把packet 进行拆包，取出数据，并显示.</span></span><br><span class="line">        <span class="comment">//实际接收到的数据字节长度</span></span><br><span class="line">        <span class="keyword">int</span> length = packet.getLength();</span><br><span class="line">        <span class="comment">//接收到数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = packet.getData();</span><br><span class="line">        String s = <span class="keyword">new</span> String(data, <span class="number">0</span>, length);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//===回复信息给B端</span></span><br><span class="line">        <span class="comment">//将需要发送的数据，封装到 DatagramPacket对象</span></span><br><span class="line">        data = <span class="string">&quot;好的, 明天见&quot;</span>.getBytes();</span><br><span class="line">        <span class="comment">//说明: 封装的 DatagramPacket对象 data 内容字节数组 , data.length , 主机(IP) , 端口</span></span><br><span class="line">        packet =</span><br><span class="line">                <span class="keyword">new</span> DatagramPacket(data, data.length, InetAddress.getLocalHost(), <span class="number">9998</span>);</span><br><span class="line"></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 关闭资源</span></span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;A端退出...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UDPSenderB</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> UDPSenderB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 发送端 B ====&gt; 也可以接收数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UDPSenderB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1.创建 DatagramSocket 对象，准备在9998端口 接收数据</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket(<span class="number">9998</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 将需要发送的数据，封装到 DatagramPacket对象</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="string">&quot;hello 明天吃火锅~&quot;</span>.getBytes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//说明: 封装的 DatagramPacket对象 data 内容字节数组 , data.length , 主机(IP) , 端口</span></span><br><span class="line">        DatagramPacket packet =</span><br><span class="line">                <span class="keyword">new</span> DatagramPacket(data, data.length, InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.=== 接收从A端回复的信息</span></span><br><span class="line">        <span class="comment">//(1)   构建一个 DatagramPacket 对象，准备接收数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        packet = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">        <span class="comment">//(2)    调用 接收方法, 将通过网络传输的 DatagramPacket 对象</span></span><br><span class="line">        <span class="comment">//   填充到 packet对象</span></span><br><span class="line">        <span class="comment">//当有数据包发送到 本机的9998端口时，就会接收到数据</span></span><br><span class="line">        <span class="comment">//   如果没有数据包发送到 本机的9998端口, 就会阻塞等待.</span></span><br><span class="line">        socket.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//(3)  可以把packet 进行拆包，取出数据，并显示.</span></span><br><span class="line">        <span class="comment">//实际接收到的数据字节长度</span></span><br><span class="line">        <span class="keyword">int</span> length = packet.getLength();</span><br><span class="line">        <span class="comment">//接收到数据</span></span><br><span class="line">        data = packet.getData();</span><br><span class="line">        String s = <span class="keyword">new</span> String(data, <span class="number">0</span>, length);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;B端退出&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-1-练习"><a href="#6-1-练习" class="headerlink" title="6.1 练习"></a>6.1 练习</h2><h3 id="6-1-1-作业1"><a href="#6-1-1-作业1" class="headerlink" title="6.1.1 作业1"></a>6.1.1 作业1</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2G1R9U"><img src="https://z3.ax1x.com/2021/06/04/2G1R9U.png" alt="2G1R9U.png"></a></p>
<p><strong>Homework01Server</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.HomeWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Homework01Server</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 服务端, 使用字符流方式读写</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Homework01Server</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//思路</span></span><br><span class="line">        <span class="comment">//1. 在本机 的9999端口监听, 等待连接</span></span><br><span class="line">        <span class="comment">//   细节: 要求在本机没有其它服务在监听9999</span></span><br><span class="line">        <span class="comment">//   细节：这个 ServerSocket 可以通过 accept() 返回多个Socket[多个客户端连接服务器的并发]</span></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端，在9999端口监听，等待连接..&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 当没有客户端连接9999端口时，程序会 阻塞, 等待连接</span></span><br><span class="line">        <span class="comment">//   如果有客户端连接，则会返回Socket对象，程序继续</span></span><br><span class="line"></span><br><span class="line">        Socket socket = serverSocket.accept();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">//3. 通过socket.getInputStream() 读取客户端写入到数据通道的数据, 显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        <span class="comment">//4. IO读取, 使用字符流, 老师使用 InputStreamReader 将 inputStream 转成字符流</span></span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String s = bufferedReader.readLine();</span><br><span class="line">        String answer = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;name&quot;</span>.equals(s)) &#123;</span><br><span class="line">            answer = <span class="string">&quot;我是zk&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;hobby&quot;</span>.equals(s)) &#123;</span><br><span class="line">            answer = <span class="string">&quot;编写java程序&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            answer = <span class="string">&quot;你说的啥子&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取socket相关联的输出流</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//    使用字符输出流的方式回复信息</span></span><br><span class="line">        BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outputStream));</span><br><span class="line">        bufferedWriter.write(answer);</span><br><span class="line">        bufferedWriter.newLine();<span class="comment">// 插入一个换行符，表示回复内容的结束</span></span><br><span class="line">        bufferedWriter.flush();<span class="comment">//注意需要手动的flush</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.关闭流和socket</span></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        bufferedReader.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();<span class="comment">//关闭</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Homework01Client</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.HomeWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Homework01Client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 客户端，发送 &quot;hello, server&quot; 给服务端， 使用字符流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Homework01Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//思路</span></span><br><span class="line">        <span class="comment">//1. 连接服务端 (ip , 端口）</span></span><br><span class="line">        <span class="comment">//解读: 连接本机的 9999端口, 如果连接成功，返回Socket对象</span></span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(InetAddress.getLocalHost(), <span class="number">9999</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 连接上后，生成Socket, 通过socket.getOutputStream()</span></span><br><span class="line">        <span class="comment">//   得到 和 socket对象关联的输出流对象</span></span><br><span class="line">        OutputStream outputStream = socket.getOutputStream();</span><br><span class="line">        <span class="comment">//3. 通过输出流，写入数据到 数据通道, 使用字符流</span></span><br><span class="line">        BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outputStream));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从键盘读取用户的问题</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入你的问题&quot;</span>);</span><br><span class="line">        String question = scanner.next();</span><br><span class="line"></span><br><span class="line">        bufferedWriter.write(question);</span><br><span class="line">        bufferedWriter.newLine();<span class="comment">//插入一个换行符，表示写入的内容结束, 注意，要求对方使用readLine()!!!!</span></span><br><span class="line">        bufferedWriter.flush();<span class="comment">// 如果使用的字符流，需要手动刷新，否则数据不会写入数据通道</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取和socket关联的输入流. 读取数据(字符)，并显示</span></span><br><span class="line">        InputStream inputStream = socket.getInputStream();</span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String s = bufferedReader.readLine();</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 关闭流对象和socket, 必须关闭</span></span><br><span class="line">        bufferedReader.close();<span class="comment">//关闭外层流</span></span><br><span class="line">        bufferedWriter.close();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-1-2-作业2"><a href="#6-1-2-作业2" class="headerlink" title="6.1.2 作业2"></a>6.1.2 作业2</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2G1ghT"><img src="https://z3.ax1x.com/2021/06/04/2G1ghT.png" alt="2G1ghT.png"></a></p>
<p><strong>Homework02ReceiverA</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.HomeWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Homework02ReceiverA</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> UDP接收端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Homework02ReceiverA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建一个 DatagramSocket 对象，准备在8888接收数据</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket(<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//2. 构建一个 DatagramPacket 对象，准备接收数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">        <span class="comment">//3. 调用 接收方法, 将通过网络传输的 DatagramPacket 对象</span></span><br><span class="line">        <span class="comment">//   填充到 packet对象</span></span><br><span class="line">        System.out.println(<span class="string">&quot;接收端 等待接收问题 &quot;</span>);</span><br><span class="line">        socket.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 可以把packet 进行拆包，取出数据，并显示.</span></span><br><span class="line">        <span class="comment">//实际接收到的数据字节长度</span></span><br><span class="line">        <span class="keyword">int</span> length = packet.getLength();</span><br><span class="line">        <span class="comment">//接收到数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = packet.getData();</span><br><span class="line">        String s = <span class="keyword">new</span> String(data, <span class="number">0</span>, length);</span><br><span class="line">        <span class="comment">//判断接收到的信息是什么</span></span><br><span class="line">        String answer = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;四大名著是哪些&quot;</span>.equals(s)) &#123;</span><br><span class="line">            answer = <span class="string">&quot;四大名著 &lt;&lt;红楼梦&gt;&gt; &lt;&lt;三国演示&gt;&gt; &lt;&lt;西游记&gt;&gt; &lt;&lt;水浒传&gt;&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            answer = <span class="string">&quot;what?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//===回复信息给B端</span></span><br><span class="line">        <span class="comment">//将需要发送的数据，封装到 DatagramPacket对象</span></span><br><span class="line">        data = answer.getBytes();</span><br><span class="line">        <span class="comment">//说明: 封装的 DatagramPacket对象 data 内容字节数组 , data.length , 主机(IP) , 端口</span></span><br><span class="line">        packet =</span><br><span class="line">                <span class="keyword">new</span> DatagramPacket(data, data.length, InetAddress.getLocalHost(), <span class="number">9998</span>);</span><br><span class="line"></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 关闭资源</span></span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;A端退出...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Homework02SenderB</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.HomeWork;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Homework02SenderB</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 发送端B ====&gt; 也可以接收数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/4 10:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Homework02SenderB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建 DatagramSocket 对象，准备在9998端口 接收数据</span></span><br><span class="line">        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket(<span class="number">9998</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 将需要发送的数据，封装到 DatagramPacket对象</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入你的问题: &quot;</span>);</span><br><span class="line">        String question = scanner.next();</span><br><span class="line">        <span class="keyword">byte</span>[] data = question.getBytes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//说明: 封装的 DatagramPacket对象 data 内容字节数组 , data.length , 主机(IP) , 端口</span></span><br><span class="line">        DatagramPacket packet =</span><br><span class="line">                <span class="keyword">new</span> DatagramPacket(data, data.length, InetAddress.getLocalHost(), <span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.=== 接收从A端回复的信息</span></span><br><span class="line">        <span class="comment">//(1)   构建一个 DatagramPacket 对象，准备接收数据</span></span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        packet = <span class="keyword">new</span> DatagramPacket(buf, buf.length);</span><br><span class="line">        <span class="comment">//(2)    调用 接收方法, 将通过网络传输的 DatagramPacket 对象</span></span><br><span class="line">        <span class="comment">//   填充到 packet对象</span></span><br><span class="line">        socket.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//(3)  可以把packet 进行拆包，取出数据，并显示.</span></span><br><span class="line">        <span class="comment">//实际接收到的数据字节长度</span></span><br><span class="line">        <span class="keyword">int</span> length = packet.getLength();</span><br><span class="line">        <span class="comment">//接收到数据</span></span><br><span class="line">        data = packet.getData();</span><br><span class="line">        String s = <span class="keyword">new</span> String(data, <span class="number">0</span>, length);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;B端退出&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-多用户即时通讯"><a href="#7-多用户即时通讯" class="headerlink" title="7. 多用户即时通讯"></a>7. 多用户即时通讯</h1><p>此项目是用来总结 <code>多线程</code>，<code>IO流</code>，<code>网络编程</code>所学的重要知识点</p>
<p><strong>先看项目 目录一览</strong></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2szH4f"><img src="https://z3.ax1x.com/2021/06/09/2szH4f.png" alt="2szH4f.png"></a></p>
<p>所包含的功能</p>
<ol>
<li>用户登录</li>
<li>拉取在线用户列表</li>
<li>无异常退出（客户端，服务端）</li>
<li>私聊</li>
<li>群聊</li>
<li>发文件</li>
<li>服务器推送新闻</li>
</ol>
<h2 id="7-1-功能实现-用户登录"><a href="#7-1-功能实现-用户登录" class="headerlink" title="7.1 功能实现-用户登录"></a>7.1 功能实现-用户登录</h2><p>先看示意图，看懂图才能了解功能如何实现！</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2ypoff"><img src="https://z3.ax1x.com/2021/06/09/2ypoff.png" alt="2ypoff.png"></a></p>
<p><strong>图解读</strong></p>
<p><strong>客户端</strong></p>
<ul>
<li>和服务端通信时，使用对象方式，可以使用<code>对象流</code>来读写</li>
<li>当客户端连接到服务端，也会得到<code>socket</code></li>
<li>启动一个线程，该线程持有<code>socket</code></li>
<li>方便管理线程，将线程放入到集合</li>
</ul>
<p><strong>服务端</strong></p>
<ul>
<li>有客户端连接到服务器，得到一个<code>socket</code></li>
<li>启动一个线程，持有该<code>socket</code>,且包含该线程所有属性</li>
<li>方便管理线程，需要使用集合管理</li>
</ul>
<h2 id="7-2-功能实现-私聊"><a href="#7-2-功能实现-私聊" class="headerlink" title="7.2 功能实现-私聊"></a>7.2 功能实现-私聊</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2ypoff"><img src="https://z3.ax1x.com/2021/06/09/2ypoff.png" alt="2ypoff.png"></a></p>
<p><strong>客户端</strong></p>
<ul>
<li>接受用户希望给其他在线用户聊天的内容</li>
<li>将消息构成<code>Message</code>对象，通过对应的<code>socket</code>发送给服务器</li>
<li>在通信线程中，读取到发送的<code>message</code>消息，显示</li>
</ul>
<p><strong>服务端</strong></p>
<ul>
<li>可以从客户端读取到消息</li>
<li>从管理线程的集合中，根据<code>message</code>对象的<code>id</code>获取对应的<code>socket</code></li>
<li>最后将<code>message</code>对象转发给指定用户</li>
</ul>
<h2 id="7-3-功能实现-发文件"><a href="#7-3-功能实现-发文件" class="headerlink" title="7.3 功能实现-发文件"></a>7.3 功能实现-发文件</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2yP7p6"><img src="https://z3.ax1x.com/2021/06/09/2yP7p6.png" alt="2yP7p6.png"></a></p>
<p><strong>客户端</strong></p>
<ul>
<li>先把文件读取到客户端，存放在字节数组中</li>
<li>把对应的文件字节数组封装到<code>message</code>对(文件内容，sender,getter)</li>
<li>将<code>message</code>对象发送给服务端</li>
<li>在接收到文件的消息后，将该文件保存到磁盘</li>
</ul>
<p><strong>服务端</strong></p>
<ul>
<li>接收<code>message</code>对象</li>
<li>拆解<code>message</code>对象的<code>id</code>，获取用户的通信线程</li>
<li>将<code>message</code>转发给指定用户</li>
</ul>
<h2 id="7-4-代码实现"><a href="#7-4-代码实现" class="headerlink" title="7.4 代码实现"></a>7.4 代码实现</h2><p>分析完看代码实现，关键方法都有注释</p>
<h3 id="7-4-1-QQServe"><a href="#7-4-1-QQServe" class="headerlink" title="7.4.1 QQServe"></a>7.4.1 QQServe</h3><p><strong>Message</strong></p>
<ul>
<li>实现序列化接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Message</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 表示客户端和服务端通信时的消息对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">//发送者</span></span><br><span class="line">    <span class="keyword">private</span> String sender;</span><br><span class="line">    <span class="comment">//接受者</span></span><br><span class="line">    <span class="keyword">private</span> String getter;</span><br><span class="line">    <span class="comment">//消息内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//发送时间</span></span><br><span class="line">    <span class="keyword">private</span> String sendTime;</span><br><span class="line">    <span class="comment">//消息类型</span></span><br><span class="line">    <span class="keyword">private</span> String mesType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行拓展 和文件相关的成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] fileBytes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> fileLen=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//文件传输的目的地</span></span><br><span class="line">    <span class="keyword">private</span> String dest;</span><br><span class="line">    <span class="comment">//源文件路径</span></span><br><span class="line">    <span class="keyword">private</span> String src;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getFileBytes() &#123;</span><br><span class="line">        <span class="keyword">return</span> fileBytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileBytes</span><span class="params">(<span class="keyword">byte</span>[] fileBytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileBytes = fileBytes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFileLen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileLen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileLen</span><span class="params">(<span class="keyword">int</span> fileLen)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileLen = fileLen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDest</span><span class="params">(String dest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dest = dest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSrc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSrc</span><span class="params">(String src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.src = src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMesType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mesType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMesType</span><span class="params">(String mesType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mesType = mesType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSender</span><span class="params">(String sender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sender = sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGetter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGetter</span><span class="params">(String getter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.getter = getter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSendTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sendTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSendTime</span><span class="params">(String sendTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sendTime = sendTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MessageType</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqcommon;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MessageType</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 表示消息类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MessageType</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    接口中定义一些常量</span></span><br><span class="line"><span class="comment">    不同常量表示不同的消息类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String MESSAGE_LOGIN_SUCCEED = <span class="string">&quot;1&quot;</span>; <span class="comment">//表示登录成功</span></span><br><span class="line">    String MESSAGE_LOGIN_FAIL = <span class="string">&quot;2&quot;</span>; <span class="comment">// 表示登录失败</span></span><br><span class="line">    String MESSAGE_COMM_MES = <span class="string">&quot;3&quot;</span>; <span class="comment">//普通信息包</span></span><br><span class="line">    String MESSAGE_GET_ONLINE_FRIEND = <span class="string">&quot;4&quot;</span>; <span class="comment">//要求返回在线用户列表</span></span><br><span class="line">    String MESSAGE_RET_ONLINE_FRIEND = <span class="string">&quot;5&quot;</span>; <span class="comment">//返回在线用户列表</span></span><br><span class="line">    String MESSAGE_CLIENT_EXIT = <span class="string">&quot;6&quot;</span>; <span class="comment">//客户端请求退出</span></span><br><span class="line">    String MESSAGE_TO_ALL_MES = <span class="string">&quot;7&quot;</span>; <span class="comment">//群发消息报</span></span><br><span class="line">    String MESSAGE_FILE_MES = <span class="string">&quot;8&quot;</span>; <span class="comment">//文件消息(发送文件)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>User</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqcommon;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> User</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 表示一个用户/客户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String userId;<span class="comment">//用户Id/用户名</span></span><br><span class="line">    <span class="keyword">private</span> String passwd;<span class="comment">//用户密码</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String userId, String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">        <span class="keyword">this</span>.passwd = passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPasswd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPasswd</span><span class="params">(String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.passwd = passwd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>工具类 方便管理输入</strong></p>
<p><strong>Utility</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> Utility</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 工具类的作用:</span></span><br><span class="line"><span class="comment"> 处理各种情况的用户输入，并且能够按照程序员的需求，得到用户的控制台输入。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utility</span> </span>&#123;</span><br><span class="line">    <span class="comment">//静态属性。。。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个菜单选项，值：1——5的范围</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 1——5</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">readMenuSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            String str = readKeyBoard(<span class="number">1</span>, <span class="keyword">false</span>);<span class="comment">//包含一个字符的字符串</span></span><br><span class="line">            c = str.charAt(<span class="number">0</span>);<span class="comment">//将字符串转换成字符char类型</span></span><br><span class="line">            <span class="keyword">if</span> (c != <span class="string">&#x27;1&#x27;</span> &amp;&amp; c != <span class="string">&#x27;2&#x27;</span> &amp;&amp;</span><br><span class="line">                    c != <span class="string">&#x27;3&#x27;</span> &amp;&amp; c != <span class="string">&#x27;4&#x27;</span> &amp;&amp; c != <span class="string">&#x27;5&#x27;</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;选择错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个字符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 一个字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">readChar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String str = readKeyBoard(<span class="number">1</span>, <span class="keyword">false</span>);<span class="comment">//就是一个字符</span></span><br><span class="line">        <span class="keyword">return</span> str.charAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的一个字符，如果直接按回车，则返回指定的默认值；否则返回输入的那个字符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 默认值或输入的字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">readChar</span><span class="params">(<span class="keyword">char</span> defaultValue)</span> </span>&#123;</span><br><span class="line">        String str = readKeyBoard(<span class="number">1</span>, <span class="keyword">true</span>);<span class="comment">//要么是空字符串，要么是一个字符</span></span><br><span class="line">        <span class="keyword">return</span> (str.length() == <span class="number">0</span>) ? defaultValue : str.charAt(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的整型，长度小于2位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 整数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">readInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            String str = readKeyBoard(<span class="number">10</span>, <span class="keyword">false</span>);<span class="comment">//一个整数，长度&lt;=10位</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                n = Integer.parseInt(str);<span class="comment">//将字符串转换成整数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;数字输入错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的 整数或默认值，如果直接回车，则返回默认值，否则返回输入的整数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 整数或默认值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">readInt</span><span class="params">(<span class="keyword">int</span> defaultValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            String str = readKeyBoard(<span class="number">10</span>, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> defaultValue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//异常处理...</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                n = Integer.parseInt(str);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;数字输入错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的指定长度的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit 限制的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指定长度的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readString</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readKeyBoard(limit, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的指定长度的字符串或默认值，如果直接回车，返回默认值，否则返回字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit 限制的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultValue 指定的默认值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指定长度的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readString</span><span class="params">(<span class="keyword">int</span> limit, String defaultValue)</span> </span>&#123;</span><br><span class="line">        String str = readKeyBoard(limit, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> str.equals(<span class="string">&quot;&quot;</span>)? defaultValue : str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能：读取键盘输入的确认选项，Y或N</span></span><br><span class="line"><span class="comment">     * 将小的功能，封装到一个方法中.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Y或N</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">readConfirmSelection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入你的选择(Y/N): 请小心选择&quot;</span>);</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;<span class="comment">//无限循环</span></span><br><span class="line">            <span class="comment">//在这里，将接受到字符，转成了大写字母</span></span><br><span class="line">            <span class="comment">//y =&gt; Y n=&gt;N</span></span><br><span class="line">            String str = readKeyBoard(<span class="number">1</span>, <span class="keyword">false</span>).toUpperCase();</span><br><span class="line">            c = str.charAt(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;Y&#x27;</span> || c == <span class="string">&#x27;N&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;选择错误，请重新输入：&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能： 读取一个字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> limit 读取的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blankReturn 如果为true ,表示 可以读空字符串。</span></span><br><span class="line"><span class="comment">     *                   如果为false表示 不能读空字符串。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果输入为空，或者输入大于limit的长度，就会提示重新输入。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">readKeyBoard</span><span class="params">(<span class="keyword">int</span> limit, <span class="keyword">boolean</span> blankReturn)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义了字符串</span></span><br><span class="line">        String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//scanner.hasNextLine() 判断有没有下一行</span></span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">            line = scanner.nextLine();<span class="comment">//读取这一行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果line.length=0, 即用户没有输入任何内容，直接回车</span></span><br><span class="line">            <span class="keyword">if</span> (line.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (blankReturn) &#123;</span><br><span class="line">                    <span class="keyword">return</span> line;<span class="comment">//如果blankReturn=true,可以返回空串</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">continue</span>; <span class="comment">//如果blankReturn=false,不接受空串，必须输入内容</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果用户输入的内容大于了 limit，就提示重写输入</span></span><br><span class="line">            <span class="comment">//如果用户如的内容 &gt;0 &lt;= limit ,我就接受</span></span><br><span class="line">            <span class="keyword">if</span> (line.length() &lt; <span class="number">1</span> || line.length() &gt; limit) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;输入长度（不能大于&quot;</span> + limit + <span class="string">&quot;）错误，请重新输入：&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ManageClientThreads</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ManageClientThreads</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 该类用于管理和客户端通信的线程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManageClientThreads</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String,ServerConnectClientThread&gt; hm=<span class="keyword">new</span> HashMap&lt;String, ServerConnectClientThread&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回hm</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String, ServerConnectClientThread&gt; <span class="title">getHm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hm;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将线程添加对象到hm集合</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">addClientThread</span><span class="params">(String userId,ServerConnectClientThread serverConnectClientThread)</span></span>&#123;</span><br><span class="line">        hm.put(userId, serverConnectClientThread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据userId，返回ServerConnectClientThread线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  ServerConnectClientThread <span class="title">getServerConnectClientThread</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hm.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加一个方法，从集合中，移除某个线程对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeServerConnectClientThread</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        hm.remove(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    返回在线用户列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getOnlineUser</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        遍历集合</span></span><br><span class="line">        Iterator&lt;String&gt; iterator = hm.keySet().iterator();</span><br><span class="line">        String onlineUserList=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            onlineUserList+=iterator.next().toString()+<span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> onlineUserList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>SendNewsToAllService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.utils.Utility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> SendNewsToAllService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 用一句话描述类的作用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendNewsToAllService</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//为了多次推送新闻可以使用while循环</span></span><br><span class="line">            System.out.println(<span class="string">&quot;输入服务器要推送的新闻/消息[输入exit表示退出服务线程]&quot;</span>);</span><br><span class="line">            String news= Utility.readString(<span class="number">100</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(news))&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//构建一个消息，群发信息</span></span><br><span class="line">            Message message=<span class="keyword">new</span> Message();</span><br><span class="line">            message.setSender(<span class="string">&quot;服务器&quot;</span>);</span><br><span class="line">            message.setMesType(MessageType.MESSAGE_TO_ALL_MES);</span><br><span class="line">            message.setContent(news);</span><br><span class="line">            message.setSendTime(<span class="keyword">new</span> Date().toString());</span><br><span class="line">            System.out.println(<span class="string">&quot;服务器推送消息给所有人 说&quot;</span>+news);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//遍历当前所有的通信线程，得到socket,并发送message</span></span><br><span class="line">            HashMap&lt;String, ServerConnectClientThread&gt; hm = ManageClientThreads.getHm();</span><br><span class="line">            Iterator&lt;String&gt; iterator = hm.keySet().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">                String onLineUserId = iterator.next().toString();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ObjectOutputStream oos</span><br><span class="line">                            = <span class="keyword">new</span> ObjectOutputStream(hm.get(onLineUserId).getSocket().getOutputStream());</span><br><span class="line">                    oos.writeObject(message);</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ServerConnectClientThread</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ServerConnectClientThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 该类的一个对象和某个客户端保持通信</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 12:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerConnectClientThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="comment">//连接服务端的id</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerConnectClientThread</span><span class="params">(Socket socket, String userId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Socket <span class="title">getSocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        label:</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;服务端和客户端&quot;</span> + userId + <span class="string">&quot; 保持通信，读取数据中！&quot;</span>);</span><br><span class="line">                ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">                Message message = (Message) ois.readObject();</span><br><span class="line">                <span class="comment">//后面根据MessageType的类型做相应的业务处理</span></span><br><span class="line">                <span class="keyword">switch</span> (message.getMesType()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MessageType.MESSAGE_GET_ONLINE_FRIEND: &#123;</span><br><span class="line">                        <span class="comment">//显示客户端在线列表</span></span><br><span class="line">                        System.out.println(message.getSender() + <span class="string">&quot; 要在线用户列表&quot;</span>);</span><br><span class="line">                        String onlineUser = ManageClientThreads.getOnlineUser();</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    返回message</span></span><br><span class="line"><span class="comment">                    构建一个Message对象 返回客户端</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                        Message message2 = <span class="keyword">new</span> Message();</span><br><span class="line">                        message2.setMesType(MessageType.MESSAGE_RET_ONLINE_FRIEND);</span><br><span class="line">                        message2.setContent(onlineUser);</span><br><span class="line">                        message2.setGetter(message.getSender());</span><br><span class="line">                        <span class="comment">//返回给客户端</span></span><br><span class="line">                        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">                        oos.writeObject(message2);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">case</span> MessageType.MESSAGE_COMM_MES: &#123;</span><br><span class="line">                        <span class="comment">//根据message获取id 然后得到对应线程</span></span><br><span class="line">                        ServerConnectClientThread serverConnectClientThread</span><br><span class="line">                                = ManageClientThreads.getServerConnectClientThread(message.getGetter());</span><br><span class="line">                        <span class="comment">//得到对应Socket的对象输出流，将message对象转发给指定的客户端</span></span><br><span class="line">                        ObjectOutputStream oos</span><br><span class="line">                                = <span class="keyword">new</span> ObjectOutputStream(serverConnectClientThread.getSocket().getOutputStream());</span><br><span class="line">                        oos.writeObject(message);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">case</span> MessageType.MESSAGE_TO_ALL_MES:</span><br><span class="line">                        <span class="comment">//需要遍历 管理线程的集合 把所有的线程的socket得到 得到把message进行转发即可</span></span><br><span class="line">                        HashMap&lt;String, ServerConnectClientThread&gt; hm = ManageClientThreads.getHm();</span><br><span class="line">                        Iterator&lt;String&gt; iterator = hm.keySet().iterator();</span><br><span class="line">                        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                            <span class="comment">//取出在线用户id</span></span><br><span class="line">                            String onLineUserId = iterator.next().toString();</span><br><span class="line">                            <span class="keyword">if</span> (!onLineUserId.equals(message.getSender())) &#123;</span><br><span class="line">                                <span class="comment">//排除群发消息的用户</span></span><br><span class="line">                                <span class="comment">//进行转发消息message</span></span><br><span class="line">                                ObjectOutputStream oos</span><br><span class="line">                                        = <span class="keyword">new</span> ObjectOutputStream(hm.get(onLineUserId).getSocket().getOutputStream());</span><br><span class="line">                                oos.writeObject(message);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MessageType.MESSAGE_FILE_MES: &#123;</span><br><span class="line">                        <span class="comment">//根据getter id 获取到对应的线程 ，将message对象转发</span></span><br><span class="line">                        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(ManageClientThreads</span><br><span class="line">                                .getServerConnectClientThread(message.getGetter()).getSocket().getOutputStream());</span><br><span class="line">                        <span class="comment">//转发</span></span><br><span class="line">                        oos.writeObject(message);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">case</span> MessageType.MESSAGE_CLIENT_EXIT:</span><br><span class="line">                        <span class="comment">//客户端退出</span></span><br><span class="line">                        System.out.println(message.getSender() + <span class="string">&quot; 退出&quot;</span>);</span><br><span class="line">                        <span class="comment">//这个客户端从对应线程删除</span></span><br><span class="line">                        ManageClientThreads.removeServerConnectClientThread(message.getSender());</span><br><span class="line">                        socket.close();</span><br><span class="line">                        <span class="keyword">break</span> label;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        System.out.println(<span class="string">&quot;其他类型的message,暂时不处理&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>QQServer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqserver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> QQServer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> QQ服务端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QQServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ServerSocket ss = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//创建一个集合，存放多个用户，如果是这些用户登录，就认为是合法</span></span><br><span class="line">    <span class="comment">//这里我们也可以使用 ConcurrentHashMap, 可以处理并发的集合，没有线程安全</span></span><br><span class="line">    <span class="comment">//HashMap 没有处理线程安全，因此在多线程情况下是不安全</span></span><br><span class="line">    <span class="comment">//ConcurrentHashMap 处理的线程安全,即线程同步处理, 在多线程情况下是安全</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConcurrentHashMap&lt;String, User&gt; validUsers = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">//private static ConcurrentHashMap&lt;String, ArrayList&lt;Message&gt;&gt; offLineDb = new ConcurrentHashMap&lt;&gt;();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123; <span class="comment">//在静态代码块，初始化 validUsers</span></span><br><span class="line"></span><br><span class="line">        validUsers.put(<span class="string">&quot;100&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        validUsers.put(<span class="string">&quot;200&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        validUsers.put(<span class="string">&quot;300&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;300&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        validUsers.put(<span class="string">&quot;400&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;400&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        validUsers.put(<span class="string">&quot;500&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;500&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line">        validUsers.put(<span class="string">&quot;600&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;600&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证用户是否有效的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkUser</span><span class="params">(String userId, String passwd)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        User user = validUsers.get(userId);</span><br><span class="line">        <span class="comment">//过关的验证方式</span></span><br><span class="line">        <span class="comment">//说明userId没有存在validUsers 的key中</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//userId正确，但是密码错误</span></span><br><span class="line">        <span class="keyword">if</span>(!user.getPasswd().equals(passwd)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QQServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//注意：端口可以写在配置文件.</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;服务端在9999端口监听...&quot;</span>);</span><br><span class="line">            <span class="comment">//启动推送新闻的线程</span></span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> SendNewsToAllService()).start();</span><br><span class="line">            ss = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</span><br><span class="line">            <span class="comment">//当和某个客户端连接后，会继续监听, 因此while</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">//如果没有客户端连接，就会阻塞在这里</span></span><br><span class="line">                Socket socket = ss.accept();</span><br><span class="line">                <span class="comment">//得到socket关联的对象输入流</span></span><br><span class="line">                ObjectInputStream ois =</span><br><span class="line">                        <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line"></span><br><span class="line">                <span class="comment">//得到socket关联的对象输出流</span></span><br><span class="line">                ObjectOutputStream oos =</span><br><span class="line">                        <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line"></span><br><span class="line">                <span class="comment">//读取客户端发送的User对象</span></span><br><span class="line">                User u = (User) ois.readObject();</span><br><span class="line">                <span class="comment">//创建一个Message对象，准备回复客户端</span></span><br><span class="line">                Message message = <span class="keyword">new</span> Message();</span><br><span class="line">                <span class="comment">//验证用户 方法</span></span><br><span class="line">                <span class="comment">//登录通过</span></span><br><span class="line">                <span class="keyword">if</span> (checkUser(u.getUserId(), u.getPasswd())) &#123;</span><br><span class="line">                    message.setMesType(MessageType.MESSAGE_LOGIN_SUCCEED);</span><br><span class="line">                    <span class="comment">//将message对象回复客户端</span></span><br><span class="line">                    oos.writeObject(message);</span><br><span class="line">                    <span class="comment">//创建一个线程，和客户端保持通信, 该线程需要持有socket对象</span></span><br><span class="line">                    ServerConnectClientThread serverConnectClientThread =</span><br><span class="line">                            <span class="keyword">new</span> ServerConnectClientThread(socket, u.getUserId());</span><br><span class="line">                    <span class="comment">//启动该线程</span></span><br><span class="line">                    serverConnectClientThread.start();</span><br><span class="line">                    <span class="comment">//把该线程对象，放入到一个集合中，进行管理.</span></span><br><span class="line">                    ManageClientThreads.addClientThread(u.getUserId(), serverConnectClientThread);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 登录失败</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;用户 id=&quot;</span> + u.getUserId() + <span class="string">&quot; pwd=&quot;</span> + u.getPasswd() + <span class="string">&quot; 验证失败&quot;</span>);</span><br><span class="line">                    message.setMesType(MessageType.MESSAGE_LOGIN_FAIL);</span><br><span class="line">                    oos.writeObject(message);</span><br><span class="line">                    <span class="comment">//关闭socket</span></span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//如果服务器退出了while，说明服务器端不在监听，因此关闭ServerSocket</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">assert</span> ss != <span class="keyword">null</span>;</span><br><span class="line">                ss.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>QQFrame</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQServe.qqframe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqserver.QQServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> QQFrame</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 该类创建QQServer ,启动后台的服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QQFrame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> QQServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-4-2-QQClient"><a href="#7-4-2-QQClient" class="headerlink" title="7.4.2 QQClient"></a>7.4.2 QQClient</h3><p><strong>UserClientService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> UserClientService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 该类完成用户登录验证和用户注册等功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserClientService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为我们可能在其他地方用使用user信息, 因此作出成员属性</span></span><br><span class="line">    <span class="keyword">private</span> User u = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="comment">//因为Socket在其它地方也可能使用，因此作出属性</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据userId 和 pwd 到服务器验证该用户是否合法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkUser</span><span class="params">(String userId, String pwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> b = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//创建User对象</span></span><br><span class="line">        u.setUserId(userId);</span><br><span class="line">        u.setPasswd(pwd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//连接到服务端，发送u对象</span></span><br><span class="line">            socket = <span class="keyword">new</span> Socket(InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">9999</span>);</span><br><span class="line">            <span class="comment">//得到ObjectOutputStream对象</span></span><br><span class="line">            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">            <span class="comment">//发送User对象</span></span><br><span class="line">            oos.writeObject(u);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//读取从服务器回复的Message对象</span></span><br><span class="line">            ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">            Message ms = (Message) ois.readObject();</span><br><span class="line">            <span class="comment">//登录OK</span></span><br><span class="line">            <span class="keyword">if</span> (ms.getMesType().equals(MessageType.MESSAGE_LOGIN_SUCCEED)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">//创建一个和服务器端保持通信的线程-&gt; 创建一个类 ClientConnectServerThread</span></span><br><span class="line">                ClientConnectServerThread clientConnectServerThread =</span><br><span class="line">                        <span class="keyword">new</span> ClientConnectServerThread(socket);</span><br><span class="line">                <span class="comment">//启动客户端的线程</span></span><br><span class="line">                clientConnectServerThread.start();</span><br><span class="line">                <span class="comment">//这里为了后面客户端的扩展，我们将线程放入到集合管理</span></span><br><span class="line">                ManageClientConnectServerThread.addClientConnectServerThread(userId, clientConnectServerThread);</span><br><span class="line">                b = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//如果登录失败, 我们就不能启动和服务器通信的线程, 关闭socket</span></span><br><span class="line">                socket.close();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向服务器端请求在线用户列表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onlineFriendList</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送一个Message , 类型MESSAGE_GET_ONLINE_FRIEND</span></span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_GET_ONLINE_FRIEND);</span><br><span class="line">        message.setSender(u.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送给服务器</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//从管理线程的集合中，通过userId, 得到这个线程对象</span></span><br><span class="line">            ClientConnectServerThread clientConnectServerThread =</span><br><span class="line">                    ManageClientConnectServerThread.getClientConnectServerThread(u.getUserId());</span><br><span class="line">            <span class="comment">//通过这个线程得到关联的socket</span></span><br><span class="line">            Socket socket = clientConnectServerThread.getSocket();</span><br><span class="line">            <span class="comment">//得到当前线程的Socket 对应的 ObjectOutputStream对象</span></span><br><span class="line">            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">            <span class="comment">//发送一个Message对象，向服务端要求在线用户列表</span></span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//编写方法，退出客户端，并给服务端发送一个退出系统的message对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_CLIENT_EXIT);</span><br><span class="line">        <span class="comment">//一定要指定我是哪个客户端id</span></span><br><span class="line">        message.setSender(u.getUserId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送message</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectOutputStream oos =</span><br><span class="line">                    <span class="keyword">new</span> ObjectOutputStream(ManageClientConnectServerThread.getClientConnectServerThread(u.getUserId()).getSocket().getOutputStream());</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">            System.out.println(u.getUserId() + <span class="string">&quot; 退出系统 &quot;</span>);</span><br><span class="line">            <span class="comment">//结束进程</span></span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MessageClientService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> MessageClientService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 私聊实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageClientService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content  内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> senderId 发送者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToAll</span><span class="params">(String content, String senderId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//构建message</span></span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_TO_ALL_MES);<span class="comment">//群发消息这种类型</span></span><br><span class="line">        message.setSender(senderId);</span><br><span class="line">        message.setContent(content);</span><br><span class="line">        message.setSendTime(<span class="keyword">new</span> Date().toString());<span class="comment">//发送时间设置到message对象</span></span><br><span class="line">        System.out.println(senderId + <span class="string">&quot; 对大家说 &quot;</span> + content);</span><br><span class="line">        <span class="comment">//发送给服务端</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectOutputStream oos =</span><br><span class="line">                    <span class="keyword">new</span> ObjectOutputStream(ManageClientConnectServerThread.getClientConnectServerThread(senderId).getSocket().getOutputStream());</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content  内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> senderId 发送用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> getterId 接收用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToOne</span><span class="params">(String content, String senderId, String getterId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//构建message</span></span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        <span class="comment">//普通的聊天消息这种类型</span></span><br><span class="line">        message.setMesType(MessageType.MESSAGE_COMM_MES);</span><br><span class="line">        message.setSender(senderId);</span><br><span class="line">        message.setGetter(getterId);</span><br><span class="line">        message.setContent(content);</span><br><span class="line">        <span class="comment">//发送时间设置到message对象</span></span><br><span class="line">        message.setSendTime(<span class="keyword">new</span> Date().toString());</span><br><span class="line">        System.out.println(senderId + <span class="string">&quot; 对 &quot;</span> + getterId + <span class="string">&quot; 说 &quot;</span> + content);</span><br><span class="line">        <span class="comment">//发送给服务端</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectOutputStream oos =</span><br><span class="line">                    <span class="keyword">new</span> ObjectOutputStream(ManageClientConnectServerThread.getClientConnectServerThread(senderId).getSocket().getOutputStream());</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>FileClientService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> FileClientService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 文件传输类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileClientService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src      源文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dest     把该文件传输到对方的哪个目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> senderId 发送用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> getterId 接收用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendFileToOne</span><span class="params">(String src, String dest, String senderId, String getterId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取src文件  --&gt;  message</span></span><br><span class="line">        Message message = <span class="keyword">new</span> Message();</span><br><span class="line">        message.setMesType(MessageType.MESSAGE_FILE_MES);</span><br><span class="line">        message.setSender(senderId);</span><br><span class="line">        message.setGetter(getterId);</span><br><span class="line">        message.setSrc(src);</span><br><span class="line">        message.setDest(dest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要将文件读取</span></span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//获取文件的长度 写入字节数组中</span></span><br><span class="line">        <span class="keyword">byte</span>[] fileBytes = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) <span class="keyword">new</span> File(src).length()];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line">            <span class="comment">//将src文件读入到程序的字节数组</span></span><br><span class="line">            fileInputStream.read(fileBytes);</span><br><span class="line">            <span class="comment">//将文件对应的字节数组设置message</span></span><br><span class="line">            message.setFileBytes(fileBytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//关闭</span></span><br><span class="line">            <span class="keyword">if</span> (fileInputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileInputStream.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//提示信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span> + senderId + <span class="string">&quot; 给 &quot;</span> + getterId + <span class="string">&quot; 发送文件: &quot;</span> + src</span><br><span class="line">                + <span class="string">&quot; 到对方的电脑的目录 &quot;</span> + dest);</span><br><span class="line">        <span class="comment">//发送</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectOutputStream oos =</span><br><span class="line">                    <span class="keyword">new</span> ObjectOutputStream(ManageClientConnectServerThread.getClientConnectServerThread(senderId).getSocket().getOutputStream());</span><br><span class="line">            oos.writeObject(message);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ClientConnectServerThread</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.Message;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.qqcommon.MessageType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ClientConnectServerThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 用一句话描述类的作用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientConnectServerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="comment">//该线程需要持有Socket</span></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器可以接受一个Socket对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientConnectServerThread</span><span class="params">(Socket socket)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//因为Thread需要在后台和服务器通信，因此我们while循环</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端线程，等待从读取从服务器端发送的消息&quot;</span>);</span><br><span class="line">                ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">                <span class="comment">//如果服务器没有发送Message对象,线程会阻塞在这里</span></span><br><span class="line">                Message message = (Message) ois.readObject();</span><br><span class="line">                <span class="comment">//注意，后面我们需要去使用message</span></span><br><span class="line">                <span class="comment">//判断这个message类型，然后做相应的业务处理</span></span><br><span class="line">                <span class="comment">//如果是读取到的是 服务端返回的在线用户列表</span></span><br><span class="line">                <span class="keyword">if</span> (message.getMesType().equals(MessageType.MESSAGE_RET_ONLINE_FRIEND)) &#123;</span><br><span class="line">                    <span class="comment">//取出在线列表信息，并显示</span></span><br><span class="line">                    <span class="comment">//规定</span></span><br><span class="line">                    String[] onlineUsers = message.getContent().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;\n=======当前在线用户列表========&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; onlineUsers.length; i++) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;用户: &quot;</span> + onlineUsers[i]);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMesType().equals(MessageType.MESSAGE_COMM_MES)) &#123;<span class="comment">//普通的聊天消息</span></span><br><span class="line">                    <span class="comment">//把从服务器转发的消息，显示到控制台即可</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;\n&quot;</span> + message.getSender()</span><br><span class="line">                            + <span class="string">&quot; 对 &quot;</span> + message.getGetter() + <span class="string">&quot; 说: &quot;</span> + message.getContent());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMesType().equals(MessageType.MESSAGE_TO_ALL_MES)) &#123;</span><br><span class="line">                    <span class="comment">//显示在客户端的控制台</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;\n&quot;</span> + message.getSender() + <span class="string">&quot; 对大家说: &quot;</span> + message.getContent());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.getMesType().equals(MessageType.MESSAGE_FILE_MES)) &#123;<span class="comment">//如果是文件消息</span></span><br><span class="line">                    <span class="comment">//让用户指定保存路径。。。</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;\n&quot;</span> + message.getSender() + <span class="string">&quot; 给 &quot;</span> + message.getGetter()</span><br><span class="line">                            + <span class="string">&quot; 发文件: &quot;</span> + message.getSrc() + <span class="string">&quot; 到我的电脑的目录 &quot;</span> + message.getDest());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//取出message的文件字节数组，通过文件输出流写出到磁盘</span></span><br><span class="line">                    FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(message.getDest(), <span class="keyword">true</span>);</span><br><span class="line">                    fileOutputStream.write(message.getFileBytes());</span><br><span class="line">                    fileOutputStream.close();</span><br><span class="line">                    System.out.println(<span class="string">&quot;\n 保存文件成功~&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;是其他类型的message, 暂时不处理....&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为了更方便的得到Socket</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Socket <span class="title">getSocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> socket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ManageClientConnectServerThread</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> ManageClientConnectServerThread</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> 线程客户端管理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManageClientConnectServerThread</span> </span>&#123;</span><br><span class="line">    <span class="comment">//我们把多个线程放入一个HashMap集合，key 就是用户id, value 就是线程</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, ClientConnectServerThread&gt; hm = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将某个线程加入到集合</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addClientConnectServerThread</span><span class="params">(String userId, ClientConnectServerThread clientConnectServerThread)</span> </span>&#123;</span><br><span class="line">        hm.put(userId, clientConnectServerThread);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过userId 可以得到对应线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ClientConnectServerThread <span class="title">getClientConnectServerThread</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hm.get(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>QQView</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zhuang.Intelnet.QQClient.views;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQClient.service.FileClientService;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQClient.service.MessageClientService;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQClient.service.UserClientService;</span><br><span class="line"><span class="keyword">import</span> com.zhuang.Intelnet.QQServe.utils.Utility;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Classname</span> QQView</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> QQ客户端启动类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/8 14:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Created</span> by dell</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;all&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QQView</span> </span>&#123;</span><br><span class="line">     <span class="comment">//控制是否显示菜单</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">boolean</span> loop = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// 接收用户的键盘输入</span></span><br><span class="line">    <span class="keyword">private</span> String key = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//对象是用于登录服务/注册用户</span></span><br><span class="line">    <span class="keyword">private</span> UserClientService userClientService = <span class="keyword">new</span> UserClientService();</span><br><span class="line">    <span class="comment">//对象用户私聊/群聊.</span></span><br><span class="line">    <span class="keyword">private</span> MessageClientService messageClientService = <span class="keyword">new</span> MessageClientService();</span><br><span class="line">    <span class="comment">//该对象用户传输文件</span></span><br><span class="line">    <span class="keyword">private</span> FileClientService fileClientService = <span class="keyword">new</span> FileClientService();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> QQView().mainMenu();</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端退出系统.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示主菜单</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">mainMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (loop) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===========欢迎登录网络通信系统===========&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;\t\t 1 登录系统&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;\t\t 9 退出系统&quot;</span>);</span><br><span class="line">            System.out.print(<span class="string">&quot;请输入你的选择: &quot;</span>);</span><br><span class="line">            key = Utility.readString(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//根据用户的输入，来处理不同的逻辑</span></span><br><span class="line">            <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                    System.out.print(<span class="string">&quot;请输入用户号: &quot;</span>);</span><br><span class="line">                    String userId = Utility.readString(<span class="number">50</span>);</span><br><span class="line">                    System.out.print(<span class="string">&quot;请输入密  码: &quot;</span>);</span><br><span class="line">                    String pwd = Utility.readString(<span class="number">50</span>);</span><br><span class="line">                    <span class="comment">//需要到服务端去验证该用户是否合法</span></span><br><span class="line">                    <span class="keyword">if</span> (userClientService.checkUser(userId, pwd)) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;===========欢迎 (用户 &quot;</span> + userId + <span class="string">&quot; 登录成功) ===========&quot;</span>);</span><br><span class="line">                        <span class="comment">//进入到二级菜单</span></span><br><span class="line">                        <span class="keyword">while</span> (loop) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;\n=========网络通信系统二级菜单(用户 &quot;</span> + userId + <span class="string">&quot; )=======&quot;</span>);</span><br><span class="line">                            System.out.println(<span class="string">&quot;\t\t 1 显示在线用户列表&quot;</span>);</span><br><span class="line">                            System.out.println(<span class="string">&quot;\t\t 2 群发消息&quot;</span>);</span><br><span class="line">                            System.out.println(<span class="string">&quot;\t\t 3 私聊消息&quot;</span>);</span><br><span class="line">                            System.out.println(<span class="string">&quot;\t\t 4 发送文件&quot;</span>);</span><br><span class="line">                            System.out.println(<span class="string">&quot;\t\t 9 退出系统&quot;</span>);</span><br><span class="line">                            System.out.print(<span class="string">&quot;请输入你的选择: &quot;</span>);</span><br><span class="line">                            key = Utility.readString(<span class="number">1</span>);</span><br><span class="line">                            <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                                    <span class="comment">//写一个方法，来获取在线用户列表</span></span><br><span class="line">                                    userClientService.onlineFriendList();</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">                                    System.out.println(<span class="string">&quot;请输入想对大家说的话: &quot;</span>);</span><br><span class="line">                                    String s = Utility.readString(<span class="number">100</span>);</span><br><span class="line">                                    messageClientService.sendMessageToAll(s, userId);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;3&quot;</span>:</span><br><span class="line">                                    System.out.print(<span class="string">&quot;请输入想聊天的用户号(在线): &quot;</span>);</span><br><span class="line">                                    String getterId = Utility.readString(<span class="number">50</span>);</span><br><span class="line">                                    System.out.print(<span class="string">&quot;请输入想说的话: &quot;</span>);</span><br><span class="line">                                    String content = Utility.readString(<span class="number">100</span>);</span><br><span class="line">                                    <span class="comment">//编写一个方法，将消息发送给服务器端</span></span><br><span class="line">                                    messageClientService.sendMessageToOne(content, userId, getterId);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;4&quot;</span>:</span><br><span class="line">                                    System.out.print(<span class="string">&quot;请输入你想把文件发送给的用户(在线用户): &quot;</span>);</span><br><span class="line">                                    getterId = Utility.readString(<span class="number">50</span>);</span><br><span class="line">                                    System.out.print(<span class="string">&quot;请输入发送文件的路径(形式 d:\\xx.jpg)&quot;</span>);</span><br><span class="line">                                    String src = Utility.readString(<span class="number">100</span>);</span><br><span class="line">                                    System.out.print(<span class="string">&quot;请输入把文件发送到对应的路径(形式 d:\\yy.jpg)&quot;</span>);</span><br><span class="line">                                    String dest = Utility.readString(<span class="number">100</span>);</span><br><span class="line">                                    fileClientService.sendFileToOne(src,dest,userId,getterId);</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;9&quot;</span>:</span><br><span class="line">                                    <span class="comment">//调用方法，给服务器发送一个退出系统的message</span></span><br><span class="line">                                    userClientService.logout();</span><br><span class="line">                                    loop = <span class="keyword">false</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; <span class="comment">//登录服务器失败</span></span><br><span class="line">                        System.out.println(<span class="string">&quot;=========登录失败=========&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;9&quot;</span>:</span><br><span class="line">                    loop = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-3-简单测试一下"><a href="#7-4-3-简单测试一下" class="headerlink" title="7.4.3 简单测试一下"></a>7.4.3 简单测试一下</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2y3neA"><img src="https://z3.ax1x.com/2021/06/09/2y3neA.png" alt="2y3neA.png"></a><br><a target="_blank" rel="noopener" href="https://imgtu.com/i/2y3udI"><img src="https://z3.ax1x.com/2021/06/09/2y3udI.png" alt="2y3udI.png"></a><br><a target="_blank" rel="noopener" href="https://imgtu.com/i/2y3eLd"><img src="https://z3.ax1x.com/2021/06/09/2y3eLd.png" alt="2y3eLd.png"></a></p>
<p><strong>总结</strong></p>
<ul>
<li>网络编程有难度，还需要多反复巩固</li>
<li>基础要扎实，项目才能熟练</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">康小庄</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/01/11/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://example.com/2021/01/11/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">康小庄的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><div class="post_share"><div class="social-share" data-image="https://pic.imgdb.cn/item/60cd5fb8844ef46bb26ac268.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/15/Java%E5%8F%8D%E5%B0%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="https://pic.imgdb.cn/item/60cd60c1844ef46bb272aef8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java反射学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/2021/01/08/JavaIO%E6%B5%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="https://pic.imgdb.cn/item/60cd5ec9844ef46bb263397f.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaIO流学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/20/SpringBoot2学习笔记/" title="SpringBoot2学习笔记"><img class="cover" src="https://pic.imgdb.cn/item/60e429695132923bf87fba9c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-20</div><div class="title">SpringBoot2学习笔记</div></div></a></div><div><a href="/2021/04/07/SpringBoot学习笔记/" title="SpringBoot学习笔记"><img class="cover" src="https://pic.imgdb.cn/item/60e429695132923bf87fba9c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-07</div><div class="title">SpringBoot学习笔记</div></div></a></div><div><a href="/2022/12/09/Elasticsearch学习笔记/" title="Elasticsearch学习笔记"><img class="cover" src="https://pic.imgdb.cn/item/63929368b1fccdcd3610a044.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-09</div><div class="title">Elasticsearch学习笔记</div></div></a></div><div><a href="/2022/12/05/RabbitMQ笔记(2)/" title="RabbitMQ学习笔记"><img class="cover" src="https://z3.ax1x.com/2021/06/01/2KKeTs.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-05</div><div class="title">RabbitMQ学习笔记</div></div></a></div><div><a href="/2022/11/11/Mysql5.7安装详解(图文版)/" title="Mysql5.7安装详解(图文版)"><img class="cover" src="https://z3.ax1x.com/2021/06/01/2KQvmF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-11</div><div class="title">Mysql5.7安装详解(图文版)</div></div></a></div><div><a href="/2022/10/18/Velocity学习笔记/" title="Velocity学习笔记"><img class="cover" src="https://pic.imgdb.cn/item/639294efb1fccdcd36127735.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-18</div><div class="title">Velocity学习笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">Java网络编程学习笔记</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%BD%91%E7%BB%9C%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">1. 网络的相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 网络通信</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E7%BD%91%E7%BB%9C"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-IP%E5%9C%B0%E5%9D%80"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 IP地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-ipv4-%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 ipv4 地址分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%9F%9F%E5%90%8D"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 域名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.6.</span> <span class="toc-text">1.6 网络通信协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-TCP%E5%92%8CUDP"><span class="toc-number">2.7.</span> <span class="toc-text">1.7 TCP和UDP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-InetAddress%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">2. InetAddress类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Socket"><span class="toc-number">4.</span> <span class="toc-text">3. Socket</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-TCP-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">5.</span> <span class="toc-text">4. TCP 网络通信编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%BB%83%E4%B9%A0"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E4%BD%BF%E7%94%A8%E5%AD%97%E8%8A%82%E6%B5%81-%E7%BB%83%E4%B9%A01"><span class="toc-number">5.1.1.</span> <span class="toc-text">4.1.1 使用字节流(练习1)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E4%BD%BF%E7%94%A8%E5%AD%97%E8%8A%82%E6%B5%81-%E7%BB%83%E4%B9%A02"><span class="toc-number">5.1.2.</span> <span class="toc-text">4.1.2 使用字节流(练习2)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E6%B5%81-%E7%BB%83%E4%B9%A03"><span class="toc-number">5.1.3.</span> <span class="toc-text">4.1.3 使用字符流(练习3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-4-%E5%8F%91%E9%80%81%E5%9B%BE%E7%89%87-%E7%BB%83%E4%B9%A04"><span class="toc-number">5.1.4.</span> <span class="toc-text">4.1.4 发送图片(练习4)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-netstat-%E6%8C%87%E4%BB%A4"><span class="toc-number">6.</span> <span class="toc-text">5. netstat 指令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-UDP-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">6. UDP 网络通信编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E7%BB%83%E4%B9%A0"><span class="toc-number">7.1.</span> <span class="toc-text">6.1 练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E4%BD%9C%E4%B8%9A1"><span class="toc-number">7.1.1.</span> <span class="toc-text">6.1.1 作业1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E4%BD%9C%E4%B8%9A2"><span class="toc-number">7.1.2.</span> <span class="toc-text">6.1.2 作业2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%A4%9A%E7%94%A8%E6%88%B7%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF"><span class="toc-number">8.</span> <span class="toc-text">7. 多用户即时通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-number">8.1.</span> <span class="toc-text">7.1 功能实现-用户登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-%E7%A7%81%E8%81%8A"><span class="toc-number">8.2.</span> <span class="toc-text">7.2 功能实现-私聊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-%E5%8F%91%E6%96%87%E4%BB%B6"><span class="toc-number">8.3.</span> <span class="toc-text">7.3 功能实现-发文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.4.</span> <span class="toc-text">7.4 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-QQServe"><span class="toc-number">8.4.1.</span> <span class="toc-text">7.4.1 QQServe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-QQClient"><span class="toc-number">8.4.2.</span> <span class="toc-text">7.4.2 QQClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B"><span class="toc-number">8.4.3.</span> <span class="toc-text">7.4.3 简单测试一下</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic.imgdb.cn/item/60cd5fb8844ef46bb26ac268.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 康小庄</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><div align=center><a href="http://beian.miit.gov.cn/"; target=_blank>苏ICP备2021027330</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.16/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?Kang-xiao-zhuang";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="Kang-xiao-zhuang";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style>undefined</style><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/tzy13755126023/BLOG_SOURCE/theme_f/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"left","width":150,"height":400},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>